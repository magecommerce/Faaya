!function(a){a.fn.reviewShare=function(b){var c=function(){a.extend(!0,this.options,b),this.bindEvent()};return c.prototype.options={customerName:"Guest",customerEmail:null,shareReviewByEmailUrl:null,defaultFailMessage:"Something went wrong.",currentRecipientCount:null,recipientMaxCount:null,maxRecipientMessage:"Max recipients limit exceeded.",_validateInstance:null,_shareReviewImage:null,_isAjaxRequestRunning:!1,pnotifyDelay:3e3},c.prototype.bindEvent=function(){a(document).on("click",".drw-share-email",{that:this},this.showEmailPopup),a(document).on("click",".drw-email-close, .email-popup-background",{that:this},this.hideEmailPopup),a(document).on("click",".drw-email-submit",{that:this},this.submitEmailShare),a(document).on("keyup",{that:this},this.closePopupOnKeyup),a(document).on("click",".add-recipient-button",{that:this},this.addRecipientEmail),a(document).on("click",".recipient-btn-remove",{that:this},this.removeRecipientEmail)},c.prototype.showEmailPopup=function(b){var c=a(".drw-email-popup-wrapper"),d=a(".drw-email-popup-image"),e=a(this).closest(".drw-box.drw-grid-item").find(".drw-image-review img").attr("src");a(this).parents("#customer-reviews").length&&(e=a(this).closest(".review-dd").find(".image-popup").attr("href"),a("html").addClass("email-share-popup"));var f=b.data.that;a(".drw-email-message-link").attr("href",a(this).data("share-url")),a(".drw-email-share-name").val(f.options.customerName),a(".drw-email-share-email").val(f.options.customerEmail),a(".drw-email-share-subject").val(a(this).data("email-subject")),a(".drw-email-share-mail-body").text(),a(".drw-email-share-link").val(a(this).data("share-url")),c.removeClass("email-share-hide").addClass("email-share-show"),a(this).closest(".drw-box").hasClass("image")||a(this).closest(".review-dd").has(".image-review").length?(a(".drw-email-share-image").val(e),d.html('<img src="'+e+'" alt="">')):c.addClass("drw-without-image")},c.prototype.closePopupOnKeyup=function(a){27==a.keyCode&&a.data.that.hideEmailPopup(a)},c.prototype.hideEmailPopup=function(b){if("undefined"!=typeof b.options&&!b.options._isAjaxRequestRunning||"undefined"!=typeof b.data&&!b.data.that.options._isAjaxRequestRunning){var c=a(".drw-email-popup-wrapper");"undefined"!=typeof b.data&&null!==b.data.that.options._validateInstance&&b.data.that.options._validateInstance.validator.reset();var d=a(".drw-share-email-messages");d.html().length>0&&d.html(""),a(".drw-email-popup-image").html(""),c.removeClass("email-share-show").removeClass("drw-without-image").addClass("email-share-hide")}},c.prototype.addRecipientEmail=function(b){var c=b.data.that;if(c.options.currentRecipientCount<c.options.recipientMaxCount){var d=a("<div/>").html('&lt;div class="additional">&lt;a href="#" class="recipient-btn-remove">x&lt;/a>&lt;input type="email" name="drw-email-share-mail-to[]" class="drw-email-share-mail-to input-text required-entry validate-email"/>&lt;/div>').text();a(this).before(d),c.options.currentRecipientCount++}else{a(this).css("display","none");var e=new PNotify({text:c.options.maxRecipientMessage,type:"info",icon:!1,buttons:{closer:!1,sticker:!1}});e.get().click(function(){e.remove()})}return!1},c.prototype.removeRecipientEmail=function(b){var c=b.data.that;return c.options.currentRecipientCount>0&&(a(this).closest(".additional").remove(),a(".add-recipient-button").css("display","block"),1==c.options.currentRecipientCount&&a(".add-recipient-button").trigger("click"),c.options.currentRecipientCount--),!1},c.prototype.submitEmailShare=function(a){var b=new VarienForm("drw-email-share-form"),c=a.data.that;b.validator.validate()?(a.preventDefault(),c.emailShareAjax()):c.options._validateInstance=b},c.prototype.emailShareAjax=function(b){var c=this;a(".drw-email-loader").removeClass("email-share-hide").addClass("email-share-show"),a.ajax({url:c.options.shareReviewByEmailUrl,data:a("#drw-email-share-form").serialize(),method:"POST",beforeSend:function(){c.options._isAjaxRequestRunning=!0}}).done(function(b){a(".drw-email-loader").removeClass("email-share-show").addClass("email-share-hide")}).fail(function(){c.buildMessageList("error",c.options.defaultFailMessage)}).complete(function(b){c.options._isAjaxRequestRunning=!1,b=a.parseJSON(b.responseText),c.buildMessageList(b.status,b.message),"success"==b.status&&(new PNotify({text:b.message,type:b.status,icon:!1}),c.hideEmailPopup(c))})},c.prototype.buildMessageList=function(b,c){var d=a(".drw-share-email-messages");d.html('<li class="'+b+'-msg"><ul><li>'+c+"</li></ul></li>"),d.removeClass("email-share-hide").addClass("email-share-show")},new c(b)}}(DRjQuery);
