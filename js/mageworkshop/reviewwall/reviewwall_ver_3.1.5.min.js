!function(a){a.widget("mageworkshop.reviewWall",{options:{template:null,baseUrl:null,baseUrlMedia:null,filter:null,endReviewMessage:"All reviews were loaded",unknownSearchCriteriaMessage:"Sorry, no reviews matched your criteria.",pnotifyDelay:3e3},_create:function(){a(window).on("scroll",a.proxy(this._onScrollEvent,this));var b=this;this.checkScrollExist=function(){document.documentElement.scrollHeight==document.documentElement.clientHeight&&0==a("#drw-end-reviews").length&&b._ajaxRequest()},b.interval=setInterval(this.checkScrollExist,500)},_setOption:function(b,c){switch(b){case"baseUrl":}a.Widget.prototype._setOption.apply(this,arguments),this._super("_setOption",b,c)},destroy:function(){a.widget.prototype.destroy.call(this)},_onScrollEvent:function(b){var c=document.getElementById("drw-ajax-load-grid");if(c){var d=c.getBoundingClientRect().top,e=c.getBoundingClientRect().bottom;d>=0&&e<=window.innerHeight&&0==a("#drw-end-reviews").length&&this._ajaxRequest()}},searchEvent:function(){this._ajaxRequest(!0)},voteEvent:function(b){var c=this,d=b,e=a(d).hasClass("helpful-btn")?1:0;a.ajax({url:a(".drw-helpful-form").attr("action"),data:{is_helpful:e,review_id:a(d).closest(".drw-js-helpful-voting").children("input[name=review_id]").attr("value")},dataType:"json",success:function(b){"success"==b.msg.type?(parseInt(e)?a(d).closest(".drw-rating-wrapper").find(".drw-helpful-qty").html(b.helpful):a(d).closest(".drw-rating-wrapper").find(".drw-unhelpful-qty").html(b.unhelpful),new PNotify({text:b.msg.text,type:"success",delay:c.options.pnotifyDelay})):new PNotify({text:b.msg.text,type:"error",delay:c.options.pnotifyDelay})}})},_removeReviews:function(b){a(".drw-box.drw-grid-item").remove(),b.masonry("reloadItems").masonry("layout")},_ajaxRequest:function(b){var c=a("#drw-container"),d=a(".drw-next-page"),e=parseInt(d.attr("data-next-page")),f=a("#review-search"),g=f.val().trim(),h=a("#drw-ajax-load-grid"),i=a(".drw-loader"),j=this,k=j.options.endReviewMessage;if("undefined"!=typeof b){e=1;var l=a(".drw-hidden-search");l.attr("value",g),k=j.options.unknownSearchCriteriaMessage,a("#drw-end-reviews").remove(),this._removeReviews(c)}i.addClass("show"),h.remove(),a.ajax({method:"POST",url:this.options.baseUrl+"mageworkshop_reviewwall/ajax/reviews/",async:!0,data:{p:e,keywords:g,filter:this.options.filter},dataType:"json"}).done(function(b){var f=[];if(Object.keys(b).length){var g=b[Object.keys(b)[Object.keys(b).length-1]].review_id;for(var h in b)if(b.hasOwnProperty(h)){var l=j._getItemElement(b[h]);if(f.push(l),h==g){var m=document.createElement("div");m.className="drw-box drw-grid-item",m.id="drw-ajax-load-grid",f.push(m)}}d.attr("data-next-page",e+1);var n=a(f);n.hide(),c.append(n).imagesLoaded(function(){n.show(),c.masonry("appended",n),c.masonry("on","layoutComplete",function(){i.removeClass("show")})}).masonry()}else{if(!a("#drw-end-reviews").length)var o=a('<div id="drw-end-reviews" class="drw-box drw-grid-item"><span>'+k+"</span></div>");i.removeClass("show"),c.append(o.show())}}).fail(function(){}).complete(function(){a(".drw-grid-item").show()})},_getItemElement:function(a){var b=this._getTimeElapsedString(a.created_at),c={baseUrl:this.options.baseUrl,baseMediaUrl:this.options.baseUrlMedia,review:a,published:b},d=this.options.template,e=doT.template(d),f=e(c),g=document.createElement("div");return g.className="drw-box drw-grid-item "+this.options.cssClassName+" drw-show",g.innerHTML=f,g},_getTimeElapsedString:function(a){var b=Math.floor((new Date-new Date(a))/1e3),c=Math.floor(b/31536e3);return c>1?c+(1!=c?" years ago by ":" year ago by "):(c=Math.floor(b/2592e3),c>1?c+ +(1!=c?" months ago by ":" month ago by "):(c=Math.floor(b/86400),c>1?c+(1!=c?" days ago by ":" day ago by "):(c=Math.floor(b/3600),c>1?c+" hours ago by ":(c=Math.floor(b/60),c>1?c+(1!=c?" minutes ago by ":" minute ago by "):Math.floor(b)+" seconds ago by "))))}})}(DRjQuery);
