<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2006-2017 X.commerce, Inc. and affiliates (http://www.magento.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php /* Extensions placeholder */ ?>
<?php echo $this->getChildHtml('checkout.onepage.login.extra')?>
    <div class="signup-buttons">
        <a class="button sign"><?php echo $this->__('SIGN UP');?></a>
    </div>
<div class="opc-acc-login">    
    <div class="col2-set">
        <?php echo $this->getChildHtml('login_before')?>
        <div class="col-1">
    	   <div class="opc-border-title"><h3><?php echo $this->__('Sign in') ?></h3></div>
            <?php echo $this->getMessagesBlock()->toHtml() ?>
            <form id="login-form" action="<?php echo $this->getPostAction() ?>" method="post">
	            <fieldset>
	                <?php echo $this->getBlockHtml('formkey'); ?>
	               <!--  <h4><?php //echo $this->__('Already registered?') ?></h4>
	                <p><?php //echo $this->__('Please log in below:') ?></p> -->
	                <ul class="form-list">
	                    <li>
	                       <!--  <label for="login-email" class="required"><em>*</em><?php //echo $this->__('Email Address') ?></label> -->
	                        <div class="input-box username">
	                            <input type="text" placeholder="Username" class="input-text required-entry validate-email" id="login-email" name="login[username]" value="<?php echo $this->escapeHtml($this->getUsername()) ?>" />
	                        </div>
	                    </li>
	                    <li>
	                       <!--  <label for="login-password" class="required"><em>*</em><?php //echo $this->__('Password') ?></label> -->
	                        <div class="input-box password">
	                            <input type="password" placeholder="Password" class="input-text required-entry" id="login-password" name="login[password]" />
	                        </div>
	                    </li>
	                    <li class="submit-btn">
	                    	<div class="buttons-set">
		                    	 <button type="submit" class="button" onclick="onepageLogin(this)"><span><span><?php echo $this->__('Login') ?></span></span></button>
	                    	</div>
	                    </li>
	                    <li class="forgot-password">
	                    	<div class="remember-me"><?php echo $this->getChildHtml('persistent.remember.me'); ?></div>
	                    	<a href="<?php echo $this->getUrl('customer/account/forgotpassword') ?>" class="f-left"><?php echo $this->__('Forgot password?') ?></a>
	                    </li>
	                    <?php echo $this->getChildHtml('form.additional.info'); ?>
	                </ul>
	            </fieldset>
            </form>

             <!-- <div class="buttons-set">
                <p class="required"><?php echo $this->__('* Required Fields') ?></p>
                <a href="<?php echo $this->getUrl('customer/account/forgotpassword') ?>" class="f-left"><?php echo $this->__('Forgot your password?') ?></a>
                <button type="submit" class="button" onclick="onepageLogin(this)"><span><span><?php echo $this->__('Login') ?></span></span></button>
                         </div> -->
           
        </div>
        <div class="col-2">
            <div class="opc-border-title"><h3><?php if( $this->getQuote()->isAllowedGuestCheckout() ): ?><?php echo $this->__('New and Guest Customers') ?><?php else: ?><?php echo $this->__('New and Guest Customers') ?><?php endif; ?></h3></div>
            <?php if( $this->getQuote()->isAllowedGuestCheckout() ): ?>
                <!-- <p><?php //echo $this->__('Register with us for future convenience:') ?></p> -->
            <?php else: ?>
               <!--  <p><strong><?php //echo $this->__('Register and save time!') ?></strong><br />
                <?php //echo $this->__('Register with us for future convenience:') ?></p> -->
                <!-- <ul>
                    <li><?php //echo $this->__('Fast and easy check out') ?></li>
                    <li><?php //echo $this->__('Easy access to your order history and status') ?></li>
                </ul> -->
            <?php endif; ?>
            <?php if( $this->getQuote()->isAllowedGuestCheckout() ): ?>
                <ul class="form-list">
                    <?php if( $this->getQuote()->isAllowedGuestCheckout() ): ?>
                    <li class="control" style="display: none;">
                        <input type="radio" name="checkout_method" id="login:guest" value="guest"<?php //if($this->getQuote()->getCheckoutMethod()==Mage_Checkout_Model_Type_Onepage::METHOD_GUEST): ?> checked="checked"<?php //endif; ?> class="radio" /><label for="login:guest"><?php echo $this->__('Checkout as Guest') ?></label>
                    </li>
                    <?php endif; ?>
                    <?php /*<li class="control">
                        <input type="radio" name="checkout_method" id="login:register" value="register"<?php if($this->getQuote()->getCheckoutMethod()==Mage_Checkout_Model_Type_Onepage::METHOD_REGISTER || !$this->getQuote()->isAllowedGuestCheckout()): ?> checked="checked"<?php endif ?> class="radio" /><label for="login:register"><?php echo $this->__('Register') ?></label>
                    </li> */?>
                </ul>
                
                <div class="content">
                    <p>By using guest checkout, you agree to Faaya’s</p>
                    <p><?php echo $this->getChildHtml('agreements')?> </p>
                </div>
       
            <?php else: ?>
                
                 <div class="content">
                    <p>By using guest checkout, you agree to Faaya’s</p>
                    <p><?php echo $this->getChildHtml('agreements')?> </p>
                </div>
                 <li class="control" style="display: none;">
                        <input type="radio" name="checkout_method" id="login:guest" value="guest"<?php //if($this->getQuote()->getCheckoutMethod()==Mage_Checkout_Model_Type_Onepage::METHOD_GUEST): ?> checked="checked"<?php //endif; ?> class="radio" /><label for="login:guest"><?php echo $this->__('Checkout as Guest') ?></label>
                 </li>
                <input type="hidden" name="checkout_method" id="login:register" value="register" checked="checked" />
            <?php endif; ?>

            <div class="buttons-set">
                <p class="required">&nbsp;</p>
                <button type="button" class="button" onclick="checkout.setMethod();"><span><span><?php echo ($this->getQuote()->isAllowedGuestCheckout() ? $this->__('Continue as guest') : $this->__('Continue as guest')) ?></span></span></button>
            </div>

        </div>
    </div>

    <!-- <div class="col2-set">
        <div class="col-1">
             
        </div>
        <div class="col-2">
        	
          
        </div>
    </div> -->
</div>
    <?php // Register form ?>
<div class="account-create" style="display: none;clear: both;">
    <?php echo $this->getChildHtml('form_fields_before')?>
    <?php echo $this->getMessagesBlock()->toHtml() ?>
    <form method="post" id="custom-form-validate" class="scaffold-form" enctype="multipart/form-data">
        <div class="col2-set">
            <div class="col-1 registered-users guest-users">
               <div class="content fieldset">

               	    <h2><?php echo $this->__('Sign up') ?></h2>

		            <input type="hidden" name="success_url" value="<?php echo $this->getSuccessUrl() ?>" />
		            <input type="hidden" name="error_url" value="<?php echo $this->getErrorUrl() ?>" />
		            <input type="hidden" name="form_key" value="<?php echo Mage::getSingleton('core/session')->getFormKey() ?>" />
		            <!-- <p><?php //echo $this->__('Please enter the following information to create your account.') ?></p> -->
		            <span class="error-msg" style="display: none;"><?php echo $this->__('There is already an account with this email address.'); ?></span>
		            <ul class="form-list">
		                <li>
		                    <?php //echo $this->getLayout()->createBlock('customer/widget_name')->setObject($this->getFormData())->setForceUseCustomerAttributes(true)->toHtml() ?>
		                	<div class="input-box username">
		                    	 <input placeholder="<?php echo $this->__('Username'); ?>" type="text" id="firstname" name="firstname" value="" title="<?php echo 'firstname'; ?>" maxlength="255" class="input-text"/>
		                    </div>
		                </li>
		                <li>
		                    <div class="input-box email">
		                        <input type="email" placeholder="<?php echo $this->__('Email Address*') ?>" autocapitalize="off" autocorrect="off" spellcheck="false" name="email" id="email_address" value="" title="<?php echo $this->quoteEscape($this->__('Email Address')) ?>" class="input-text validate-email required-entry" />
		                    </div>
		                </li>
		                <li>
	                       <div class="input-box password">
	                            <input placeholder="<?php echo $this->__('Password*') ?>" type="password" name="password" id="password" title="<?php echo $this->quoteEscape($this->__('Password')) ?>" class="input-text required-entry validate-password" />
	                        </div>
		                </li>
		                <li>
		                	 <div class="input-box password">
	                            <input placeholder="<?php echo $this->__('Confirm Password*') ?>" type="password" name="confirmation" title="<?php echo $this->quoteEscape($this->__('Confirm Password')) ?>" id="confirmation" class="input-text required-entry validate-cpassword" />
	                        </div>
		                </li>
		                <?php //echo $this->getChildHtml('form.additional.info'); ?>
		                <?php //echo $this->getChildHtml('persistent.remember.me'); ?>
		                <li class="submit-btn">
		                	<div class="buttons-set"> 
		                    	<button type="button" title="<?php echo $this->quoteEscape($this->__('Register')) ?>" class="button custom-register"><span><span><?php echo $this->__('Register') ?></span></span></button>
		                    </div>	
		                </li>
		                 <li class="signup-for-offers">
	                        <input type="radio" class="radio" id="offers-update" name="offers-update" value="1" checked=""/>
	                        <label for="offers-update"><?php echo $this->__('Sign up for offers updates'); ?></label>
	                     </li>    
		            </ul>
		            <?php //echo $this->getChildHtml('persistent.remember.me.tooltip'); ?>
        		</div>
        	</div>
        </div>	
        <?php if (Mage::helper('checkout')->isContextCheckout()): ?>
            <input name="context" type="hidden" value="checkout" />
        <?php endif; ?>
    </form>
    <script type="text/javascript">
    //<![CDATA[
        var dataForm = new VarienForm('form-validate', true);
        <?php if($this->getShowAddressFields()): ?>
        new RegionUpdater('country', 'region', 'region_id', <?php echo $this->helper('directory')->getRegionJson() ?>, undefined, 'zip');
        <?php endif; ?>
    //]]>
    </script>
</div>
<?php // ========= End Register Form ========== ?>
<script type="text/javascript">
jQuery(document).ready(function(){ 
   jQuery(".sign").click(function(){
       var txt = jQuery(this).text();   
       if(txt == "SIGN UP"){
           jQuery(this).text("SIGN IN");
           jQuery(".account-create").show();
           jQuery(".opc-acc-login").hide();
       }else{
           jQuery(this).text("SIGN UP");
           jQuery(".opc-acc-login").show();
           jQuery(".account-create").hide();
       }
   }); 
   jQuery(".custom-register").click(function(){
        var dataForm = new VarienForm('custom-form-validate', true);
        if(dataForm.validator.validate()){ 
            var url = '<?php echo $this->getUrl('customregister/index/register');?>';
            var firstname = jQuery("#firstname").val();
            var email_address = jQuery("#email_address").val();
            var password = jQuery("#password").val();
            var confirmation = jQuery("#confirmation").val();
            var isSubscribe = 0;
            if(jQuery("#offers-update").is(':checked')){
                isSubscribe = jQuery("#offers-update").val();
            } 
            jQuery.ajax({
                url : url,
                dataType : 'html',
                type: 'POST',
                data: {firstname:firstname,email_address:email_address,password:password,confirmation:confirmation,isSubscribe:isSubscribe},
                success : function(data) {
                    response = JSON.parse(data);
                    if(response['success']){
                        jQuery(".opc-billing h2").trigger('click');
                        window.location.href = '<?php echo $this->getUrl('checkout/onepage/');?>';
                    }else{
                      // alert(response['fail']);
                       jQuery(".error-msg").show();
                    }
                }
            }); 
        }
   });
});
//<![CDATA[
    var loginForm = new VarienForm('login-form', true);
    $('login-email').observe('keypress', bindLoginPost);
    $('login-password').observe('keypress', bindLoginPost);
    function bindLoginPost(evt){
        if (evt.keyCode == Event.KEY_RETURN) {
            loginForm.submit();
        }
    }
    function onepageLogin(button)
    {
        if(loginForm.validator && loginForm.validator.validate()){
            button.disabled = true;
            loginForm.submit();
        }
    }
//]]>
</script>
